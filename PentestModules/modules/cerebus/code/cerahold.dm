/obj/item/mecha_parts/mecha_equipment/cerehold
	name = "mounted holding device"
	desc = "Carries a Cerebus crew's salvage team"
	icon = 'icons/obj/machines/sleeper.dmi'
	icon_state = "sleeper"
	energy_drain = 20
	range = MECHA_MELEE
	equip_cooldown = 20
	var/mob/living/carbon/salvager = null

/obj/item/mecha_parts/mecha_equipment/cerehold/Destroy()
	for(var/atom/movable/AM in src)
		AM.forceMove(get_turf(src))

	return ..()
/obj/item/mecha_parts/mecha_equipment/cerehold/Exit(atom/movable/O)
	return 0

/obj/item/mecha_parts/mecha_equipment/cerehold/action(mob/living/carbon/target)
	if(!action_checks(target))
		return
	if(!istype(target))
		return
	if(!patient_insertion_check(target))
		return
	occupant_message("<span class='notice'>You start putting [target] into [src]...</span>")
	chassis.visible_message("<span class='warning'>[chassis] starts putting [target] into \the [src].</span>")
	if(do_after_cooldown(target))
		if(!patient_insertion_check(target))
			return
		target.forceMove(src)
		salvager = target
		START_PROCESSING(SSobj, src)
		update_equip_info()
		occupant_message("<span class='notice'>[target] successfully loaded into [src]. Life support functions engaged.</span>")
		chassis.visible_message("<span class='warning'>[chassis] loads [target] into [src].</span>")
		log_message("[target] loaded. Life support functions engaged.", LOG_MECHA)

/obj/item/mecha_parts/mecha_equipment/cerehold/proc/patient_insertion_check(mob/living/carbon/target)
	if(target.buckled)
		occupant_message("<span class='warning'>[target] will not fit into the sleeper because [target.p_theyre()] buckled to [target.buckled]!</span>")
		return
	if(target.has_buckled_mobs())
		occupant_message("<span class='warning'>[target] will not fit into the sleeper because of the creatures attached to it!</span>")
		return
	if(salvager)
		occupant_message("<span class='warning'>The sleeper is already occupied!</span>")
		return
	return 1
/obj/item/mecha_parts/mecha_equipment/medical/sleeper/proc/go_out()
	if(!patient)
		return
	salvager.forceMove(get_turf(src))
	occupant_message("<span class='notice'>[salvager] ejected. Life support functions disabled.</span>")
	log_message("[patient] ejected. Life support functions disabled.", LOG_MECHA)
	STOP_PROCESSING(SSobj, src)
	salvager = null
	update_equip_info()

/obj/item/mecha_parts/mecha_equipment/cerehold/container_resist_act(mob/living/user)
	go_out()


